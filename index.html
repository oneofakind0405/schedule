<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒì„± ê¸°ë°˜ ì¼ì • ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .api-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }

        .api-section h3 {
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-section {
            margin-bottom: 25px;
        }

        .input-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .voice-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }

        .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .voice-btn.recording {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .clear-btn {
            background: #e2e8f0;
            color: #4a5568;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .clear-btn:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }

        .input-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #cbd5e0;
            border-radius: 15px;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .process-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            margin-top: 15px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .process-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
        }

        .process-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-section {
            margin-top: 30px;
            padding: 25px;
            background: #f7fafc;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            display: none;
        }

        .result-section.show {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            async initializeGoogleAPI() {
                try {
                    // Google API ë¡œë“œ ëŒ€ê¸°
                    await new Promise((resolve) => {
                        if (window.gapi) {
                            resolve();
                        } else {
                            window.addEventListener('load', resolve);
                        }
                    });

                    // ë°ëª¨ìš©ìœ¼ë¡œ ê°„ë‹¨í•œ Google Calendar URL ìƒì„± ë°©ì‹ ì‚¬ìš©
                    this.showAuthStatus('Google Calendar ì—°ë™ ì¤€ë¹„ ì™„ë£Œ', 'success');
                    this.googleAuthBtn.textContent = 'Google Calendarë¡œ ë°”ë¡œ ì¶”ê°€';
                    this.isGoogleAuthorized = true;
                } catch (error) {
                    console.error('Google API ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    this.showAuthStatus('Google Calendar ì—°ë™ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                }
            }

            handleGoogleAuth() {
                if (this.isGoogleAuthorized) {
                    this.showAuthStatus('Google Calendar ì—°ë™ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    this.showAuthStatus('Google Calendar ì—°ë™ì„ ì‹œë„í•˜ëŠ” ì¤‘...', 'info');
                    // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” OAuth í”„ë¡œì„¸ìŠ¤ ì§„í–‰
                    setTimeout(() => {
                        this.isGoogleAuthorized = true;
                        this.googleAuthBtn.textContent = 'âœ… ì—°ë™ ì™„ë£Œ';
                        this.showAuthStatus('Google Calendar ì—°ë™ ì™„ë£Œ!', 'success');
                    }, 1500);
                }
            }

            showAuthStatus(message, type) {
                this.authStatus.style.display = 'block';
                this.authStatus.className = `status ${type}`;
                this.authStatus.textContent = message;
                
                setTimeout(() => {
                    this.authStatus.style.display = 'none';
                }, 3000);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-item {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .result-label {
            font-weight: 700;
            color: #4a5568;
            min-width: 80px;
            margin-right: 15px;
        }

        .result-value {
            color: #2d3748;
            flex: 1;
            font-size: 16px;
        }

        .calendar-btn {
            background: linear-gradient(135deg, #3182ce, #2c5282);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .calendar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(49, 130, 206, 0.3);
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #667eea;
            font-weight: 600;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .status.info {
            background: #bee3f8;
            color: #2a4365;
            border: 1px solid #90cdf4;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            .input-controls {
                flex-direction: column;
            }

            .voice-btn, .clear-btn {
                width: 100%;
            }

            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .result-label {
                min-width: auto;
                margin-right: 0;
            }
        }

        .icon {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ìŒì„± ê¸°ë°˜ ì¼ì • ê´€ë¦¬</h1>
        
        <!-- API í‚¤ ì„¤ì • ì„¹ì…˜ -->
        <div class="api-section">
            <h3>
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H4v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z" clip-rule="evenodd"></path>
                </svg>
                OpenAI API í‚¤ ì„¤ì •
            </h3>
            <input 
                type="password" 
                id="apiKey" 
                class="api-key-input" 
                placeholder="OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (sk-...)"
            >
        </div>

        <!-- Google Calendar ì—°ë™ ì„¹ì…˜ -->
        <div class="api-section">
            <h3>
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                </svg>
                Google Calendar ì—°ë™
            </h3>
            <button id="googleAuthBtn" class="process-btn" style="margin-top: 10px;">
                Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
            </button>
            <div id="authStatus" class="status" style="display: none;"></div>
        </div>

        <!-- ìŒì„±/í…ìŠ¤íŠ¸ ì…ë ¥ ì„¹ì…˜ -->
        <div class="input-section">
            <div class="input-controls">
                <button id="voiceBtn" class="voice-btn">
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                    </svg>
                    ìŒì„± ì…ë ¥
                </button>
                <button id="clearBtn" class="clear-btn">
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"></path>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    ì§€ìš°ê¸°
                </button>
            </div>
            <textarea 
                id="inputText" 
                class="input-textarea" 
                placeholder="ì¼ì •ì„ ë§í•˜ê±°ë‚˜ í…ìŠ¤íŠ¸ë¡œ ì…ë ¥í•˜ì„¸ìš”. &#10;ì˜ˆ: 'ë‹¤ìŒ ì£¼ í™”ìš”ì¼ ì˜¤í›„ 2ì‹œì— êµë¬´íšŒì˜ ìˆìŒ'"
            ></textarea>
            <button id="processBtn" class="process-btn">ì¼ì • ì •ë³´ ì¶”ì¶œí•˜ê¸°</button>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ ì„¹ì…˜ -->
        <div id="resultSection" class="result-section">
            <h3 style="margin-bottom: 20px; color: #4a5568;">ğŸ“… ì¶”ì¶œëœ ì¼ì • ì •ë³´</h3>
            <div id="resultContent"></div>
            <button id="calendarBtn" class="calendar-btn">
                <svg class="icon" fill="currentColor" viewBox="0 0 20 20" style="margin-right: 8px;">
                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                </svg>
                Google Calendarì— ì¶”ê°€
            </button>
        </div>

        <!-- ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="statusDiv"></div>
    </div>

    <!-- Google APIs ë¡œë“œ -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>

    <script>
        class VoiceScheduleApp {
            constructor() {
                this.recognition = null;
                this.isRecording = false;
                this.extractedData = null;
                this.gapi = null;
                this.isGoogleAuthorized = false;
                this.CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID'; // ì‚¬ìš©ìê°€ ì„¤ì •í•´ì•¼ í•¨
                this.API_KEY = 'YOUR_GOOGLE_API_KEY'; // ì‚¬ìš©ìê°€ ì„¤ì •í•´ì•¼ í•¨
                this.DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
                this.SCOPES = 'https://www.googleapis.com/auth/calendar';
                
                this.initializeElements();
                this.setupEventListeners();
                this.loadApiKey();
                this.initializeSpeechRecognition();
                this.initializeGoogleAPI();
            }

            initializeElements() {
                this.apiKeyInput = document.getElementById('apiKey');
                this.voiceBtn = document.getElementById('voiceBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.inputText = document.getElementById('inputText');
                this.processBtn = document.getElementById('processBtn');
                this.resultSection = document.getElementById('resultSection');
                this.resultContent = document.getElementById('resultContent');
                this.calendarBtn = document.getElementById('calendarBtn');
                this.statusDiv = document.getElementById('statusDiv');
                this.googleAuthBtn = document.getElementById('googleAuthBtn');
                this.authStatus = document.getElementById('authStatus');
            }

            setupEventListeners() {
                this.apiKeyInput.addEventListener('input', () => this.saveApiKey());
                this.voiceBtn.addEventListener('click', () => this.toggleVoiceRecording());
                this.clearBtn.addEventListener('click', () => this.clearInput());
                this.processBtn.addEventListener('click', () => this.processSchedule());
                this.calendarBtn.addEventListener('click', () => this.addToCalendar());
                this.googleAuthBtn.addEventListener('click', () => this.handleGoogleAuth());
            }

            loadApiKey() {
                const savedApiKey = JSON.parse(localStorage.getItem('openai_api_key') || 'null');
                if (savedApiKey) {
                    this.apiKeyInput.value = savedApiKey;
                }
            }

            saveApiKey() {
                const apiKey = this.apiKeyInput.value.trim();
                if (apiKey) {
                    localStorage.setItem('openai_api_key', JSON.stringify(apiKey));
                }
            }

            initializeSpeechRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    this.showStatus('ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.', 'error');
                    this.voiceBtn.disabled = true;
                    return;
                }

                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                
                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.lang = 'ko-KR';

                this.recognition.onstart = () => {
                    this.isRecording = true;
                    this.voiceBtn.classList.add('recording');
                    this.voiceBtn.innerHTML = `
                        <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a2 2 0 114 0v4a2 2 0 11-4 0V7z" clip-rule="evenodd"></path>
                        </svg>
                        ë…¹ìŒ ì¤‘...
                    `;
                    this.showStatus('ìŒì„±ì„ ë“£ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                };

                this.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    this.inputText.value += (this.inputText.value ? ' ' : '') + transcript;
                    this.showStatus('ìŒì„±ì´ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                };

                this.recognition.onerror = (event) => {
                    this.showStatus(`ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ${event.error}`, 'error');
                    this.resetVoiceButton();
                };

                this.recognition.onend = () => {
                    this.resetVoiceButton();
                };
            }

            toggleVoiceRecording() {
                if (!this.recognition) return;

                if (this.isRecording) {
                    this.recognition.stop();
                } else {
                    this.recognition.start();
                }
            }

            resetVoiceButton() {
                this.isRecording = false;
                this.voiceBtn.classList.remove('recording');
                this.voiceBtn.innerHTML = `
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"></path>
                    </svg>
                    ìŒì„± ì…ë ¥
                `;
            }

            clearInput() {
                this.inputText.value = '';
                this.resultSection.classList.remove('show');
                this.extractedData = null;
                this.showStatus('ì…ë ¥ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.', 'info');
            }

            async processSchedule() {
                const inputText = this.inputText.value.trim();
                const apiKey = this.apiKeyInput.value.trim();

                if (!inputText) {
                    this.showStatus('ì¼ì • ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                if (!apiKey) {
                    this.showStatus('OpenAI API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }

                this.processBtn.disabled = true;
                this.processBtn.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        ì²˜ë¦¬ ì¤‘...
                    </div>
                `;

                try {
                    const extractedData = await this.callOpenAI(inputText, apiKey);
                    this.extractedData = extractedData;
                    this.displayResults(extractedData);
                    this.showStatus('ì¼ì • ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    this.showStatus(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                } finally {
                    this.processBtn.disabled = false;
                    this.processBtn.innerHTML = 'ì¼ì • ì •ë³´ ì¶”ì¶œí•˜ê¸°';
                }
            }

            async callOpenAI(inputText, apiKey) {
                const currentDate = new Date().toISOString().split('T')[0];
                
                const prompt = `ë‹¤ìŒ ë¬¸ì¥ì—ì„œ ì¼ì • ê´€ë ¨ ì •ë³´ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”. ê¸°ì¤€ ë‚ ì§œëŠ” ${currentDate}ì…ë‹ˆë‹¤.

ë¬¸ì¥: "${inputText}"

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:
{
    "date": "YYYY-MM-DD í˜•ì‹ì˜ ë‚ ì§œ (ì¶”ì¶œ ë¶ˆê°€ì‹œ null)",
    "time": "HH:MM í˜•ì‹ì˜ ì‹œê°„ (ì¶”ì¶œ ë¶ˆê°€ì‹œ null)",
    "task": "í•  ì¼ì´ë‚˜ ì¼ì • ë‚´ìš©",
    "location": "ì¥ì†Œ (ì¶”ì¶œ ë¶ˆê°€ì‹œ null)",
    "target": "ëŒ€ìƒìë‚˜ ì°¸ì„ì (ì¶”ì¶œ ë¶ˆê°€ì‹œ null)",
    "duration": "ì†Œìš” ì‹œê°„ (ì¶”ì¶œ ë¶ˆê°€ì‹œ null)"
}

ìì—°ì–´ë¡œ í‘œí˜„ëœ ë‚ ì§œì™€ ì‹œê°„ì„ ì •í™•í•œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”.
ì˜ˆ: "ë‹¤ìŒ ì£¼ í™”ìš”ì¼" â†’ ì‹¤ì œ ë‚ ì§œ ê³„ì‚°
ì˜ˆ: "ì˜¤í›„ 2ì‹œ" â†’ "14:00"`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'ë‹¹ì‹ ì€ ìì—°ì–´ì—ì„œ ì¼ì • ì •ë³´ë¥¼ ì¶”ì¶œí•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì •í™•í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.1,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
                }

                const data = await response.json();
                const content = data.choices[0].message.content.trim();
                
                try {
                    return JSON.parse(content);
                } catch (e) {
                    // JSON íŒŒì‹± ì‹¤íŒ¨ì‹œ ì •ê·œì‹ìœ¼ë¡œ JSON ë¶€ë¶„ ì¶”ì¶œ ì‹œë„
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }
                    throw new Error('ì‘ë‹µ í˜•ì‹ì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            displayResults(data) {
                const formatValue = (value) => value || 'ì •ë³´ ì—†ìŒ';
                const formatDateTime = () => {
                    if (data.date && data.time) {
                        return `${data.date} ${data.time}`;
                    } else if (data.date) {
                        return data.date;
                    } else if (data.time) {
                        return `ì‹œê°„: ${data.time}`;
                    }
                    return 'ì •ë³´ ì—†ìŒ';
                };

                this.resultContent.innerHTML = `
                    <div class="result-item">
                        <div class="result-label">ğŸ“… ì¼ì‹œ:</div>
                        <div class="result-value">${formatDateTime()}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">ğŸ“ í•  ì¼:</div>
                        <div class="result-value">${formatValue(data.task)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">ğŸ“ ì¥ì†Œ:</div>
                        <div class="result-value">${formatValue(data.location)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">ğŸ‘¥ ëŒ€ìƒ:</div>
                        <div class="result-value">${formatValue(data.target)}</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">â±ï¸ ì†Œìš”ì‹œê°„:</div>
                        <div class="result-value">${formatValue(data.duration)}</div>
                    </div>
                `;

                this.resultSection.classList.add('show');
            }

            addToCalendar() {
                if (!this.extractedData) {
                    this.showStatus('ì¶”ì¶œëœ ì¼ì • ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                // Google Calendarì— ì¶”ê°€í•˜ëŠ” ì—¬ëŸ¬ ê°€ì§€ ë°©ë²• ì œê³µ
                this.createGoogleCalendarEvent();
            }

            createGoogleCalendarEvent() {
                const data = this.extractedData;
                
                // ë‚ ì§œì™€ ì‹œê°„ ì²˜ë¦¬
                let startDateTime = '';
                let endDateTime = '';
                
                if (data.date && data.time) {
                    const dateStr = data.date;
                    const timeStr = data.time;
                    startDateTime = `${dateStr}T${timeStr}:00`;
                    
                    // ì¢…ë£Œ ì‹œê°„ ê³„ì‚° (1ì‹œê°„ í›„ ë˜ëŠ” duration ì‚¬ìš©)
                    const startDate = new Date(startDateTime);
                    const endDate = new Date(startDate);
                    
                    if (data.duration) {
                        // durationì´ ìˆìœ¼ë©´ íŒŒì‹±í•´ì„œ ì¶”ê°€
                        const durationMatch = data.duration.match(/(\d+)/);
                        const hours = durationMatch ? parseInt(durationMatch[1]) : 1;
                        endDate.setHours(endDate.getHours() + hours);
                    } else {
                        endDate.setHours(endDate.getHours() + 1);
                    }
                    
                    endDateTime = endDate.toISOString().slice(0, 19);
                } else if (data.date) {
                    // í•˜ë£¨ ì¢…ì¼ ì´ë²¤íŠ¸
                    startDateTime = data.date;
                    const nextDay = new Date(data.date);
                    nextDay.setDate(nextDay.getDate() + 1);
                    endDateTime = nextDay.toISOString().slice(0, 10);
                } else {
                    this.showStatus('ë‚ ì§œ ì •ë³´ê°€ ì—†ì–´ ìº˜ë¦°ë”ì— ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                // Google Calendar URL ìƒì„±
                const calendarUrl = this.generateGoogleCalendarUrl({
                    title: data.task || 'ìƒˆë¡œìš´ ì¼ì •',
                    startDateTime: startDateTime,
                    endDateTime: endDateTime,
                    location: data.location || '',
                    description: this.generateEventDescription(data)
                });

                // ìƒˆ ì°½ì—ì„œ Google Calendar ì—´ê¸°
                const newWindow = window.open(calendarUrl, '_blank', 'width=800,height=600');
                
                if (newWindow) {
                    this.showStatus('Google Calendarì—ì„œ ì¼ì •ì„ í™•ì¸í•˜ê³  ì €ì¥í•˜ì„¸ìš”!', 'success');
                } else {
                    // íŒì—…ì´ ì°¨ë‹¨ëœ ê²½ìš° ëŒ€ì•ˆ ì œê³µ
                    this.showCalendarUrlDialog(calendarUrl);
                }

                // ì½˜ì†”ì—ë„ ì •ë³´ ì¶œë ¥
                console.log('Google Calendar ì¼ì • ì •ë³´:', {
                    title: data.task || 'ìƒˆë¡œìš´ ì¼ì •',
                    startDateTime,
                    endDateTime,
                    location: data.location,
                    description: this.generateEventDescription(data),
                    url: calendarUrl
                });
            }

            generateGoogleCalendarUrl(eventData) {
                const baseUrl = 'https://calendar.google.com/calendar/render';
                const params = new URLSearchParams({
                    action: 'TEMPLATE',
                    text: eventData.title,
                    dates: this.formatGoogleCalendarDates(eventData.startDateTime, eventData.endDateTime),
                    location: eventData.location,
                    details: eventData.description
                });

                return `${baseUrl}?${params.toString()}`;
            }

            formatGoogleCalendarDates(startDateTime, endDateTime) {
                // Google Calendar í˜•ì‹ìœ¼ë¡œ ë‚ ì§œ ë³€í™˜
                const formatDateTime = (dateTime) => {
                    if (dateTime.includes('T')) {
                        // ì‹œê°„ì´ ìˆëŠ” ê²½ìš°
                        return dateTime.replace(/[-:]/g, '').replace('T', 'T') + '00Z';
                    } else {
                        // í•˜ë£¨ ì¢…ì¼ ì´ë²¤íŠ¸
                        return dateTime.replace(/-/g, '');
                    }
                };

                const start = formatDateTime(startDateTime);
                const end = formatDateTime(endDateTime);
                return `${start}/${end}`;
            }

            generateEventDescription(data) {
                let description = '';
                
                if (data.target) {
                    description += `ì°¸ì„ì: ${data.target}\n`;
                }
                
                if (data.duration) {
                    description += `ì†Œìš”ì‹œê°„: ${data.duration}\n`;
                }
                
                description += '\nìŒì„± ê¸°ë°˜ ì¼ì • ê´€ë¦¬ ì•±ìœ¼ë¡œ ìƒì„±ëœ ì¼ì •ì…ë‹ˆë‹¤.';
                
                return description;
            }

            showCalendarUrlDialog(url) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `;

                modal.innerHTML = `
                    <div style="
                        background: white;
                        padding: 30px;
                        border-radius: 15px;
                        max-width: 500px;
                        width: 90%;
                        text-align: center;
                    ">
                        <h3 style="margin-bottom: 20px; color: #4a5568;">Google Calendarì— ì¶”ê°€</h3>
                        <p style="margin-bottom: 20px; color: #666;">íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ Google Calendarì— ì¼ì •ì„ ì¶”ê°€í•˜ì„¸ìš”.</p>
                        <a href="${url}" target="_blank" style="
                            display: inline-block;
                            background: linear-gradient(135deg, #3182ce, #2c5282);
                            color: white;
                            padding: 12px 24px;
                            border-radius: 25px;
                            text-decoration: none;
                            font-weight: 600;
                            margin-bottom: 15px;
                        ">Google Calendarì—ì„œ ì—´ê¸°</a>
                        <br>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: #e2e8f0;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 20px;
                            cursor: pointer;
                        ">ë‹«ê¸°</button>
                    </div>
                `;

                document.body.appendChild(modal);
                
                // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    this.showStatus('Google Calendar ë§í¬ê°€ ì œê³µë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                }, 100);
            }

            showStatus(message, type) {
                this.statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
                setTimeout(() => {
                    this.statusDiv.innerHTML = '';
                }, 5000);
            }
        }

        // ì•± ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            new VoiceScheduleApp();
        });
    </script>
</body>
</html>
